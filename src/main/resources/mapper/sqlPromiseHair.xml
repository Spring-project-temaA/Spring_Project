<?xml version="1.0" encoding="UTF-8"?>
<!--mybatis SQL 매핑-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.smp_1.mapper.promiseHairMapper">
    <!--    유저 회원가입-->
    <insert id="signUser" parameterType="com.example.smp_1.dto.userDto">
        INSERT INTO user (user_id, user_pw, user_name, user_ph, user_mail, user_gen)
        VALUES (#{userId}, #{userPw}, #{userName}, #{userPh}, #{userMail}, #{userGen})
    </insert>

    <!--    유저 아이디 중복확인-->
    <select id="checkUserId" parameterType="String" resultType="int">
        SELECT COUNT(user_id)
        FROM user
        WHERE user_id = #{userId}
    </select>

    <!--    유저 전화번호 중복확인-->
    <select id="checkUserPh" parameterType="String" resultType="int">
        SELECT COUNT(user_ph)
        FROM user
        WHERE user_ph = #{userPh}
    </select>

    <!--    유저 이메일 중복확인-->
    <select id="checkUserMail" parameterType="String" resultType="int">
        SELECT COUNT(user_id)
        FROM user
        WHERE user_mail = #{userMail}
    </select>

    <!--    사업자 회원가입-->
    <insert id="signOwner" parameterType="com.example.smp_1.dto.shopDto">
        INSERT INTO shop (shop_id, shop_pw, shop_name, shop_tel, shop_addr_num, shop_addr_jibun, shop_addr_road,
                          shop_addr_detail, owner_name, owner_mail, owner_ph,
                          owner_gen)
        VALUES (#{shopId}, #{shopPw}, #{shopName}, #{shopTel}, #{shopAddrNum}, #{shopAddrJibun}, #{shopAddrRoad},
                #{shopAddrDetail}, #{ownerName}, #{ownerMail},
                #{ownerPh}, #{ownerGen})
    </insert>

    <!--    사업자 아이디 중복확인-->
    <select id="checkShopId" parameterType="String" resultType="int">
        SELECT COUNT(shop_id)
        FROM shop
        WHERE shop_id = #{shopId}
    </select>

    <!--    가게 전화번호 중복확인-->
    <select id="checkShopTel" parameterType="String" resultType="int">
        SELECT COUNT(shop_tel)
        FROM shop
        WHERE shop_tel = #{shopTel}
    </select>

    <!--    사업자 전화번호 중복확인-->
    <select id="checkOwnerPh" parameterType="String" resultType="int">
        SELECT COUNT(owner_ph)
        FROM shop
        WHERE owner_ph = #{ownerPh}
    </select>

    <!--    사업자 이메일 중복확인-->
    <select id="checkOwnerMail" parameterType="String" resultType="int">
        SELECT COUNT(owner_mail)
        FROM shop
        WHERE owner_mail = #{ownerMail}
    </select>

    <!--    유저 로그인-->
    <select id="checkUserLogin" parameterType="String" resultType="com.example.smp_1.dto.userDto">
        SELECT *
        FROM user
        WHERE user_id = #{userId}
          AND user_pw = #{userPw}
    </select>

    <!--    Shop 로그인-->
    <select id="checkShopLogin" parameterType="String" resultType="com.example.smp_1.dto.shopDto">
        SELECT *
        FROM shop
        WHERE shop_id = #{shopId}
          AND shop_pw = #{shopPw}
    </select>
    <!--    예약-->
    <insert id="insertAppointment" parameterType="com.example.smp_1.dto.apointDto">
        INSERT INTO apoint (apoint_time, apoint_cut, apoint_perm, apoint_color, apoint_clinic, apoint_shop, apoint_date,
                            apoint_user_name, apoint_user_id, apoint_user_ph)
        VALUES (#{apointTime}, #{apointCut}, #{apointPerm}, #{apointColor}, #{apointClinic}, #{apointShop},
                #{apointDate}, #{apointUserName}, #{apointUserId}, #{apointUserPh})
    </insert>
    <!--    Shop Name 뿌리기-->
    <select id="selectShopName" resultType="String">
        SELECT shop_name
        FROM shop
    </select>
    <!--    예약 확인-->
    <select id="apointCheck" parameterType="String" resultType="com.example.smp_1.dto.apointDto">
        SELECT *
        FROM apoint
        WHERE apoint_user_id = #{apointUserId}
          AND apoint_yn = 'N'
    </select>

    <!--    유저 정보 수정 / 유저 정보 업데이트 -->
    <update id="updateUserInfo" parameterType="com.example.smp_1.dto.userDto">
        update user
        set user_pw   = #{userPw},
            user_ph   = #{userPh},
            user_mail = #{userMail}
        where user_id = #{userId}
    </update>

    <!--    세션 최신화-->
    <select id="changeSession" parameterType="String" resultType="com.example.smp_1.dto.userDto">
        SELECT *
        FROM user
        WHERE user_id = #{userId}
    </select>

    <!--    모든 예약 정보 가져오기-->
    <select id="getApoints" parameterType="String" resultType="com.example.smp_1.dto.apointDto">
        SELECT *
        FROM apoint
        WHERE apoint_user_id = #{apointUserId} Order by apoint_num
    </select>
</mapper>
